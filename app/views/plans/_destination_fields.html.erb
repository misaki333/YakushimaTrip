<div class="nested-fields">
  <div class="destination-edit">
    <div class="destination_time">
      <%= f.time_select :time, {}, class: 'form-control', include_blank: true %>
    </div>

    <%= f.fields_for :spots do |s| %>
      <div id="parent">
        <%= s.collection_select :category_id, Category.all, :id, :name, :prompt => "選択してください", class: "parent" %>
      </div>

    <div id="child">
      <%= f.collection_select :spot_id, Spot.all, :id, :name,:prompt => "", class: "child" %>
    </div>

    <% end %>

    <div class="plan_content">
      <%= f.text_area :to_do, class: 'form-control' %>
    </div>

    <%= link_to_remove_association '削除', f %>
  </div>
</div>

<script>

var noValue = $('.child').html(); //#childの最初の状態を保存



$('.parent').on('change', function(){

  var cat = $(this).val(); //選択された項目のvalueを取得

  if(cat){ //valueに何か値が入っていた場合

    var item = products[cat]; //リストからカテゴリに登録された製品の配列を取得

    $('.child').html('');

    var option;

    for(var i = 0; i < item.length; i++){

      option = '<option value="' + item[i] + '">' + item[i] + '</option>';

      $('.child').append(option);

    }

  }else{ //valueに何も値が入っていない場合

    $('.child').html(noValue); //保存された最初の状態に戻す

  }
</script>